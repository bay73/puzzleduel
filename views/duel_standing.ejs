<style>
  .tooltip-inner {
    white-space:pre-wrap;
    text-align:left;
    line-height: 120%;
    font-family: verdana;
    font-size: small;
  }
</style>
<div class="row">
  <div class="col-sm-3">
    <h3 class="row justify-content-center"><%= __('Puzzles') %></h3>
    <div class="row justify-content-left">
      <div class="col-auto">
        <table class="table table-responsive table-condensed">
          <tbody>
            <% puzzles.sort((p1, p2) => p1.puzzleNum - p2.puzzleNum).forEach(function(puz) { %>
            <tr>
              <td>
                <%= puz.num %>
              </td>
              <td>
                <% if (puz.revealDate < new Date) { %>
                <a href="javascript:void(0);" onclick="showRoundResults('<%= puz.num %>','<%= puz.code %>','<%= puz.type %><%= puz.dimension?" ("+puz.dimension+")":"" %>')" >
                <% } %>
                <%= puz.type %>
                <%= puz.dimension?" ("+puz.dimension+")":"" %>
                <% if (puz.revealDate < new Date) { %>
                </a>
                <% } %>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-sm-9">
    <% if (contest.status == 'registration') { %>
    <p class="row"><%= __('Here you can see the list of solvers who are already registered for paricipation in the contest') %></p>
    <% } else {%>
    <h3 class="row justify-content-center"><%= __('Results') %></h3>
    <% } %>
    <div class="row justify-content-center">
      <div class="col-auto">
        <table class="table table-responsive table-bordered table-hover table-condensed">
          <tbody>
            <tr class="table">
              <th>
              </th>
              <th class="text-center">
                <%= __('Rating') %>
              </th>
              <% if (contest.status != 'registration') { %>
              <th class="text-center">
                <%= __('Contest score') %>
              </th>
              <% } %>
            </tr>
            <% users.sort((u1, u2) => {if (u1.score==u2.score) {return u2.rating - u1.rating;} else {return u2.score - u1.score;}}).forEach(function(user) { %>
            <tr class="table">
              <td>
                <%= user.name %>
              </td>
              <td class="text-center">
                <%= user.rating > 0?Math.round(user.rating):"" %>
              </td>
              <% if (contest.status != 'registration') { %>
              <td class="text-center">
                <span data-toggle="tooltip" title="<%= user.seedDetails %>">
                <%= user.score %>
                <% if (user.scoreSum) { %>
                (<% for(var num=1; num<=contest.lastPuzzleNum; num++) { %><%= num>1?"+":"" %><%= user.scoreSum[num.toString()]?user.scoreSum[num.toString()]:0 %><% } %>)
                <% } %>
                </span>
              </td>
              <% } %>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
    <% if (contest.status == 'registration') { %>
    <div class="d-flex justify-content-between">
      <% if (userData.isRegistered) { %>
      <p class="text-left"><%= __("Press the button if you don't want to participate") %></p>
      <p class="text-left"><a class="btn btn-primary" href="/duel/<%= contest.code %>/unregister"><%= __('Leave') %></a></p>
      <% } else if (user) { %>
      <p class="text-left"><%= __("Presss the button if you want to paricipate") %></p><br>
      <p class="text-left"><a class="btn btn-primary" href="/duel/<%= contest.code %>/register"><%= __('Enroll') %></a></p>
      <% } else { %>
      <p class="text-info"><%- __('You should <a href="/users/login">Login</a> first to be able to register for participation') %></p>
      <% }%>
    </div>
    <% } %>
  </div>
</div>
<div class="modal" id="roundResults" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Results of round <span id="roundResultsNum"></span></h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-center container-fluid">
        <h5 id="roundPuzzleName"></h5>
        <a href="#" id="roundPuzzleLink"><%= __('Go to puzzle') %></a>
        <p id="roundResultsTable"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div><script>
  $(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip({placement: "auto"});
  });
  function showRoundResults(num, puzzleCode, puzzleDesc) {
    $("#roundResultsNum").text(num);
    $("#roundPuzzleName").html(puzzleDesc);
    $("#roundPuzzleLink").attr("href", "/single/"+puzzleCode);
    $("#roundResultsTable").load("/duel/<%= contest.code%>/results/"+num);
    $("#roundResults").modal();
  }
</script>

