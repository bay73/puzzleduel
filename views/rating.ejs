<script
  src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"
  integrity="sha256-bqVeqGdJ7h/lYPq6xrPv/YGzMEb6dNxlfiTUHSgRCp8=" crossorigin="anonymous">
</script>
<link
  rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css"
  integrity="sha256-siyOpF/pBWUPgIcQi17TLBkjvNgNQArcmwJB8YvkAgg=" crossorigin="anonymous"
/>
<%- include ('./partials/navbar') %>
<div class="container">
  <div class="row">
    <div class="col-12 m-auto">
      <%- include ('./partials/messages') %>
      <div class="card">
        <div class="d-flex flex-row flex-wrap justify-content-between card-header">
          <h1 class="">Solvers Rating <%= ratingFinal?"":" (preliminary)" %>
          </h1>
          <div class="p-2 align-bottom text-right" style="position: relative;">
            <h2>
              <%= ratingDate.toISOString().split('T')[0] %>
              <a class="btn" data-toggle="collapse" href="#choosedate" aria-expanded="false" aria-controls="Collapse">
                <span class="glyphicon glyphicon-collapse-down"></span>
              </a>
            </h2>
            <div class="collapse bg-secondary text-white"
                 style="position: absolute; top: 45; left: -30; z-index: 100;" id="choosedate">
              <div class="card card-body">
                <div id="datepicker" data-date="<%= ratingDate.toISOString().split('T')[0] %>"></div>
                <button type="submit" id="setDate" class="btn btn-primary">Set</button>
              </div>
            </div>
            <script>
              $(document).ready(function () {
                $('#datepicker').datepicker({
                  format: "yyyy-mm-dd",
                  startDate: "2020-04-01",
                  endDate: "+7d",
                  maxViewMode: "month"});
              });
              $("#setDate").click(function () {
                var url="/rating/" + $('#datepicker').datepicker('getFormattedDate');
                window.location = url;
              });
            </script>
          </div>
        </div>
        <div class="row card-body">
          <% if (typeof user != 'undefined' && user.role=='admin') { %>
          <div class="col-2 d-flex flex-row-reverse flex-wrap">
            <a class="btn btn-primary" href="/rating/<%= ratingDate.toISOString().split('T')[0] %>/recount">Recount</a>
          </div>
          <% } %>
        </div>
        <div class="card-body">
          <table class="table table-hover table-condensed table-striped">
            <tbody>
              <tr>
                <th></th>
                <th class="text-center">Rating</th>
                <th class="text-center">Weekly change</th>
              </tr>
              <% ratings.sort((r1,r2) => r2.value - r1.value).forEach(function(rating) { %>
              <tr>
                <td><%= rating.userName %></td>
                <td class="text-center"><%= Math.round(rating.value) %></td>
                <td class="text-center <%= rating.change < 0?'text-warning':(rating.change > 0?'text-success':'')%>"><%= rating.change?Math.round(rating.change):"-" %></td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<%- include ('./partials/footer') %>

